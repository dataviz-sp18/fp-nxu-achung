---
title: "Final Project"
author: "Alice Mee Seon Chung, Ningyin Xu"
output: 
  flexdashboard::flex_dashboard:
    vertical_layout: scroll
    orientation: columns
    source_code: embed
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE,
                      warning = FALSE,
                      echo = FALSE,
                      cache = F)
library(tidyverse)
library(ggplot2)
library(flexdashboard)
library(shiny)
library(plotly)

options(digits = 3)
set.seed(1234)
options(scipen=999)
theme_set(theme_minimal())
load("data.RData")

```

Introduction
=====================================  


Income vs. GDP
=====================================  

Input {.sidebar}
---------------------------------------------------

```{r 3, echo=FALSE}
selectizeInput('year', label = "Select Year",
            choices = c(2010,2014), selected = 2010)
selectizeInput('province', label = "Select Province",
          choices = c("All", sort((unique(joined_10_prov2$provcd)))),
            selected = "All")
```

Row {data-width=800}
--------------------------------------------------

### Mean of Income and GDP Gap by Year

```{r 4, echo=FALSE}
plot_province<-function(data){
  ggplot(data = data,
             aes(x = mean_income, y = GDP, 
               fill = provcd))+ 
  geom_point(aes(size = count), shape = 21, alpha = 0.7)+
  labs(size = 'Province ID')+
  scale_size_continuous(range = c(1,8.5)) +
  scale_x_continuous(name = "Mean of Income", 
                     limits = c(0, 40000)) +
  scale_y_continuous(name = "GDP",
                     limits = c(0, 7000000)) +
  guides(fill=guide_legend(title='Province ID'))+
  theme(legend.position = "bottom", 
        panel.grid.major = element_line(colour = "#d3d3d3"),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())}

plot_province_city<- function(data){
  ggplot(data =data,
             aes(x = mean_income, y = GDP, 
               fill = provcd))+ 
  geom_point(aes(size = count), shape = 21, alpha = 0)+
  geom_point(data = filter(data, 
                           provcd %in% input$province), 
             aes(size = count, fill='blank'), shape = 21) +
  labs(size = 'Province ID')+
  scale_size_continuous(range = c(1,8.5)) +
  scale_x_continuous(name = "Mean of Income",
                     limits = c(0, 40000)) +
  scale_y_continuous(name = "GDP",
                     limits = c(0, 7000000)) +
  guides(fill=guide_legend(title='Province ID'))+
  theme(legend.position = "bottom", 
        panel.grid.major = element_line(colour = "#d3d3d3"),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank())}

```

```{r 5, echo=FALSE}
renderPlotly(
    if(input$year == 2010){
    if(input$province=='All') {
  pp<-plot_province(joined_10_prov2)}
    else{
      pp<-plot_province_city(joined_10_prov2)
    }
    }
    else{
      if(input$province=='All') {
    pp<-plot_province(joined_14_prov2)}
    else{
      pp<-plot_province_city(joined_14_prov2)
    }
    })
```


Income Gain: 2010 - 2014
==========================================================================

```{r, eval=FALSE, include=FALSE}
p2<-ggplot(china.all.df, aes(x=long, y=lat, map_id = provcd))+
        geom_polygon(aes(fill=ch$diffincome, group = provcd), ) +
        scale_fill_gradient(low="white", high="red", name="Difference of mean income\n")+
        geom_path(color="gray", size=0.3) +
        coord_fixed(ratio = 1)+
        expand_limits(x = china.all.df$long, y = china.all.df$lat) +
        theme(axis.line=element_blank(),
              axis.text.x=element_blank(),
              axis.text.y=element_blank(),
              axis.ticks=element_blank(),
              axis.title.x=element_blank(),
              axis.title.y=element_blank(),
              panel.background=element_blank(),
              panel.border=element_blank(),
              panel.grid.major=element_blank(),
              panel.grid.minor=element_blank(),
              plot.background=element_blank())
```


Row {data-width=800}
--------------------------------------------------

### Difference in Mean of Income between 2014 and 2010 by Provinces
```{r, echo=FALSE, fig.height= 8, fig.width=12}
renderPlotly(p2<-ggplot(china.all.df, aes(x=long, y=lat, map_id = provcd))+
        geom_polygon(aes(fill=ch$diffincome )) +
        scale_fill_gradient(low="white", high="red", name="Difference of Mean Income \n between 2014 and 2010")+
        geom_path(color="black", size=0.3) +
        coord_fixed(ratio = 1)+
        expand_limits(x = china.all.df$long, y = china.all.df$lat) +
        labs(caption ='Note: The region colored in grey is the area that does not have record in data.')+
        theme(axis.line=element_blank(),
              axis.text.x=element_blank(),
              axis.text.y=element_blank(),
              axis.ticks=element_blank(),
              axis.title.x=element_blank(),
              axis.title.y=element_blank(),
              panel.background=element_blank(),
              panel.border=element_blank(),
              panel.grid.major=element_blank(),
              panel.grid.minor=element_blank(),
              plot.background=element_blank()))
```


What's influencing income?
==========================================================================

Input {.sidebar}
----------------------------------

```{r}
radioButtons(inputId = "influencingFactor",
               label = "Choose an Influencing Factor that you're interested in",
               choices = c("age", "age square", "gender", 
                           "education", 
                           "number of convenience stores", 
                           "number of primary schools", 
                           "number of hospitals",
                           "water source", 
                           "community population",
                           "travel time to nearest town",
                           "travel time to county seat",
                           "agricultural GDP",
                           "non-agricultural GDP",
                           "income per capita"),
               selected = "age")

```


Column
----------------------------------

### Distribution of the Interested Variable
```{r}
load("./plots.RData")

plotOutput("dist")
output$dist <- renderPlot({
  plots_df[["dist"]][[input$influencingFactor]]
})

```

### Relationship of Personal Income vs. Intersted Variable
```{r}
plotOutput("inc")
output$inc <- renderPlot({
  plots_df[["inc"]][[input$influencingFactor]]
})
```











